@model List<MVC_project.ViewModels.TripDashboardViewModel>

@{
    ViewData["Title"] = "Available Trips";
}

<style>
    /* Animated Background - matching existing design */
    .dashboard-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(-45deg, #6366f1, #3730a3, #a78bfa, #6366f1);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
        z-index: -1;
    }

    @@keyframes gradient {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    /* Floating particles - matching existing design */
    .particle {
        position: fixed;
        pointer-events: none;
        opacity: 0.5;
        animation: float 20s infinite linear;
        z-index: -1;
    }

    @@keyframes float {
        0% {
            transform: translate(0, 0) rotate(0deg);
            opacity: 0;
        }
        10% {
            opacity: 0.5;
        }
        90% {
            opacity: 0.5;
        }
        100% {
            transform: translate(100px, -100vh) rotate(360deg);
            opacity: 0;
        }
    }

    /* Main container */
    .trips-container {
        position: relative;
        min-height: 100vh;
        padding: 2rem 1rem;
        overflow-y: auto;
    }

    /* Page header */
    .page-header {
        text-align: center;
        margin-bottom: 3rem;
        animation: slideInDown 0.8s ease-out;
    }

    .page-title {
        color: white;
        font-size: 3rem;
        font-weight: 700;
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
        margin-bottom: 0.5rem;
    }

    .page-subtitle {
        color: rgba(255, 255, 255, 0.9);
        font-size: 1.2rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    }

    @@keyframes slideInDown {
        from {
            opacity: 0;
            transform: translateY(-50px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Search button */
    .search-button {
        display: inline-block;
        margin-top: 1.5rem;
    }

    .btn-search {
        background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 0.75rem;
        text-decoration: none;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        transition: all 0.2s ease;
        display: inline-block;
    }

    .btn-search:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.6);
        color: white;
    }

    /* Grid layout for trip cards */
    .trips-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 2rem;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 1rem;
    }

    @@media (max-width: 768px) {
        .trips-grid {
            grid-template-columns: 1fr;
        }
    }

    /* Trip card - matching existing card design */
    .trip-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 1.5rem;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 20px 70px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.5);
        transition: all 0.3s ease;
        animation: slideInUp 0.8s ease-out;
        position: relative;
        cursor: pointer;
        border: 2px solid transparent;
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .trip-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 30px 90px rgba(99, 102, 241, 0.3);
        border-color: rgba(99, 102, 241, 0.3);
    }

    @@keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(50px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Trip image */
    .trip-image-container {
        width: 100%;
        height: 250px;
        overflow: hidden;
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        position: relative;
    }

    .trip-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .trip-card:hover .trip-image {
        transform: scale(1.1);
    }

    .no-image-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
    }

    .no-image-placeholder i {
        font-size: 4rem;
        color: #0284c7;
        opacity: 0.5;
    }

    /* Trip details */
    .trip-details {
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        flex-grow: 1;
    }

    .trip-destination {
        color: #1e293b;
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .trip-country {
        color: #64748b;
        font-size: 1rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .trip-country i {
        color: #6366f1;
    }

    .trip-info {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        margin-bottom: 1rem;
    }

    .info-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #475569;
        font-size: 0.95rem;
    }

    .info-item i {
        color: #6366f1;
        width: 20px;
    }

    .trip-description {
        color: #64748b;
        font-size: 0.9rem;
        line-height: 1.6;
        margin-bottom: 1rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* Price section */
    .trip-price-section {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding-top: 1rem;
        border-top: 2px solid #e2e8f0;
    }

    .price-container {
        display: flex;
        flex-direction: column;
    }

    .trip-price {
        color: #1e293b;
        font-size: 1.8rem;
        font-weight: 700;
    }

    .original-price {
        color: #94a3b8;
        font-size: 1rem;
        text-decoration: line-through;
    }

    .discount-badge {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.85rem;
        font-weight: 600;
    }

    /* Package type badge */
    .package-badge {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.75rem;
        font-size: 0.85rem;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        z-index: 1;
    }

    /* Visibility badge for admin */
    .visibility-badge {
        position: absolute;
        top: 1rem;
        left: 1rem;
        display: flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.5rem 0.9rem;
        border-radius: 0.75rem;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        z-index: 2;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .visibility-badge.visible {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
    }

    .visibility-badge.hidden {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
    }

    .visibility-badge:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .visibility-badge:active {
        transform: scale(0.98);
    }

    .visibility-badge.loading {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .visibility-badge i {
        font-size: 1rem;
    }

    /* Button container - fixed to bottom of card */
    .trip-actions {
        display: flex;
        gap: 0.75rem;
        margin-top: auto;
        padding-top: 1.5rem;
        border-top: 2px solid #e2e8f0;
    }

    /* User action buttons */
    .btn-add-cart {
        background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
        color: white;
        border: none;
        padding: 0.75rem 1rem;
        border-radius: 0.75rem;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        flex: 1;
    }

    .btn-add-cart:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.6);
        color: white;
    }

    .btn-book-now {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        border: none;
        padding: 0.75rem 1rem;
        border-radius: 0.75rem;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        flex: 1;
    }

    .btn-book-now:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(16, 185, 129, 0.6);
        color: white;
    }

    /* Delete button (admin only) */
    .delete-btn {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
        border: none;
        padding: 0.75rem 1rem;
        border-radius: 0.75rem;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        flex: 1;
    }

    .delete-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(239, 68, 68, 0.6);
        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
    }

    .delete-btn:active {
        transform: translateY(0);
    }

    /* Edit button (admin only) */
    .edit-btn {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        color: white;
        border: none;
        padding: 0.75rem 1rem;
        border-radius: 0.75rem;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        text-decoration: none;
        flex: 1;
    }

    .edit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(245, 158, 11, 0.6);
        background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
        color: white;
    }

    .edit-btn:active {
        transform: translateY(0);
    }

    /* Trip Modal Overlay */
    .trip-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at center, rgba(99, 102, 241, 0.15), rgba(0, 0, 0, 0.95));
        backdrop-filter: blur(10px);
        z-index: 9998;
        overflow-y: auto;
    }

    .trip-modal.active {
        display: block;
        animation: modalBackdropFadeIn 0.4s ease;
    }

    .modal-content {
        max-width: 1200px;
        margin: 2rem auto;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 250, 252, 0.98) 100%);
        border-radius: 2rem;
        padding: 2.5rem;
        position: relative;
        box-shadow: 0 40px 100px rgba(99, 102, 241, 0.3), 
                    0 20px 60px rgba(0, 0, 0, 0.4),
                    inset 0 1px 0 rgba(255, 255, 255, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.5);
        transform-origin: center;
    }

    /* Modal quantity row responsiveness */
    .modal-qty-row {
        flex-wrap: wrap;
        margin-bottom: 1rem;
    }

    .qty-control { 
        min-width: 160px;
    }

    @@media (max-width: 700px) {
        .modal-content { padding: 1rem; margin: 1rem; }
        .modal-qty-row { gap: 0.5rem; }
        .qty-control { min-width: 120px; }
    }

    .modal-content.expand-animation {
        animation: expandFromCard 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .modal-content::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, #6366f1, #a78bfa, #6366f1);
        border-radius: 2rem;
        z-index: -1;
        opacity: 0.3;
        filter: blur(20px);
    }

    .modal-close {
        position: absolute;
        top: 1.5rem;
        right: 1.5rem;
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
        border: none;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        font-size: 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        z-index: 10;
        box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
    }

    .modal-close:hover {
        transform: rotate(90deg) scale(1.15);
        box-shadow: 0 12px 30px rgba(239, 68, 68, 0.6);
        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
    }

    .modal-close:active {
        transform: rotate(90deg) scale(1.05);
    }

    /* Photo Carousel */
    .photo-carousel {
        position: relative;
        width: 100%;
        margin-bottom: 2rem;
    }

    .carousel-main {
        position: relative;
        width: 100%;
        height: 500px;
        background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 50%, #e0f2fe 100%);
        border-radius: 1.5rem;
        overflow: hidden;
        margin-bottom: 1.5rem;
        box-shadow: inset 0 2px 20px rgba(99, 102, 241, 0.1),
                    0 10px 40px rgba(0, 0, 0, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.5);
    }

    .carousel-image {
        width: 100%;
        height: 100%;
        object-fit: contain;
        display: none;
    }

    .carousel-image.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    .carousel-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.95));
        color: #6366f1;
        border: 2px solid rgba(99, 102, 241, 0.2);
        width: 56px;
        height: 56px;
        border-radius: 50%;
        font-size: 1.6rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        z-index: 5;
        box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3),
                    0 4px 10px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
    }

    .carousel-arrow:hover {
        background: linear-gradient(135deg, #6366f1, #7c3aed);
        color: white;
        border-color: transparent;
        transform: translateY(-50%) scale(1.15);
        box-shadow: 0 12px 35px rgba(99, 102, 241, 0.5),
                    0 6px 15px rgba(0, 0, 0, 0.3);
    }

    .carousel-arrow:active {
        transform: translateY(-50%) scale(1.05);
    }

    .carousel-arrow.prev {
        left: 1rem;
    }

    .carousel-arrow.next {
        right: 1rem;
    }

    .carousel-counter {
        position: absolute;
        bottom: 1rem;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 2rem;
        font-size: 0.9rem;
        font-weight: 600;
    }

    /* Thumbnail Strip */
    .carousel-thumbnails {
        display: flex;
        gap: 0.75rem;
        overflow-x: auto;
        padding: 0.5rem;
        background: rgba(248, 250, 252, 0.8);
        border-radius: 0.75rem;
        scrollbar-width: thin;
        scrollbar-color: #cbd5e1 #f1f5f9;
    }

    .carousel-thumbnails::-webkit-scrollbar {
        height: 6px;
    }

    .carousel-thumbnails::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 3px;
    }

    .carousel-thumbnails::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
    }

    .thumbnail {
        min-width: 100px;
        width: 100px;
        height: 80px;
        object-fit: cover;
        border-radius: 0.5rem;
        cursor: pointer;
        border: 3px solid transparent;
        transition: all 0.3s ease;
        opacity: 0.6;
    }

    .thumbnail:hover {
        opacity: 1;
        transform: scale(1.05);
    }

    .thumbnail.active {
        border-color: #6366f1;
        opacity: 1;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
    }

    .carousel-loading,
    .carousel-empty {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #64748b;
        font-size: 1.2rem;
    }

    /* Modal trip details */
    .modal-trip-header {
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 3px solid transparent;
        background: linear-gradient(white, white) padding-box,
                    linear-gradient(90deg, #6366f1, #a78bfa, #6366f1) border-box;
        border-image: linear-gradient(90deg, #6366f1, #a78bfa, #6366f1) 1;
    }

    .modal-trip-title {
        color: #1e293b;
        font-size: 2.5rem;
        font-weight: 800;
        margin-bottom: 0.75rem;
        background: linear-gradient(135deg, #1e293b 0%, #475569 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .modal-trip-location {
        color: #6366f1;
        font-size: 1.3rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1rem;
    }

    .modal-trip-location i {
        font-size: 1.5rem;
        animation: pulse 2s ease-in-out infinite;
    }

    @@keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    .modal-trip-description {
        color: #475569;
        font-size: 1rem;
        line-height: 1.8;
        margin-bottom: 1rem;
    }

    /* Additional trip details */
    .additional-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .detail-item {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        padding: 1rem;
        border-radius: 0.75rem;
        border: 1px solid #e2e8f0;
    }

    .detail-item strong {
        color: #6366f1;
        display: block;
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
    }

    .detail-item span {
        color: #1e293b;
        font-size: 1rem;
        font-weight: 600;
    }

    /* Action buttons */
    .trip-actions {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .btn-action {
        flex: 1;
        min-width: 150px;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 0.75rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }

    .btn-add-cart {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
    }

    .btn-add-cart:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(16, 185, 129, 0.6);
    }

    .btn-book-now {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
    }

    .btn-book-now:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(245, 158, 11, 0.6);
    }

    /* Date Variations Section */
    .date-variations-section {
        padding: 1.5rem;
        margin: 1.5rem 0;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-radius: 1rem;
        border: 2px solid #e2e8f0;
    }

    .date-variations-list {
        display: grid;
        gap: 0.75rem;
    }

    .date-variation-item {
        background: white;
        padding: 1rem;
        border-radius: 0.75rem;
        border: 2px solid #e2e8f0;
        transition: all 0.3s ease;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 0.75rem;
    }

    .date-variation-item:hover {
        border-color: #6366f1;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
        transform: translateY(-2px);
    }

    .date-variation-info {
        display: flex;
        gap: 1.5rem;
        flex-wrap: wrap;
        align-items: center;
    }

    .date-variation-info > div {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #475569;
        font-size: 0.95rem;
    }

    .date-variation-info i {
        color: #6366f1;
    }

    .date-variation-info strong {
        font-weight: 600;
        color: #1e293b;
    }

    @@keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @@keyframes modalBackdropFadeIn {
        from {
            opacity: 0;
            backdrop-filter: blur(0px);
        }
        to {
            opacity: 1;
            backdrop-filter: blur(10px);
        }
    }

    @@keyframes expandFromCard {
        from {
            opacity: 0;
            transform: translate(var(--start-x), var(--start-y)) scale(0.3);
            border-radius: 1.5rem;
        }
        to {
            opacity: 1;
            transform: translate(0, 0) scale(1);
            border-radius: 2rem;
        }
    }

    @@keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(50px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @@media (max-width: 768px) {
        .modal-content {
            margin: 1rem;
            padding: 1.5rem;
        }

        .carousel-main {
            height: 300px;
        }

        .carousel-arrow {
            width: 40px;
            height: 40px;
            font-size: 1.2rem;
        }

        .thumbnail {
            min-width: 80px;
            width: 80px;
            height: 60px;
        }
    }

    /* Empty state */
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 2rem;
        max-width: 600px;
        margin: 0 auto;
        box-shadow: 0 20px 70px rgba(0, 0, 0, 0.2);
    }

    .empty-state i {
        font-size: 5rem;
        color: #cbd5e1;
        margin-bottom: 1rem;
    }

    .empty-state h2 {
        color: #1e293b;
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .empty-state p {
        color: #64748b;
        font-size: 1.1rem;
    }
</style>

<!-- Animated Background -->
<div class="dashboard-bg"></div>

<!-- Floating particles -->
<script>
    for (let i = 0; i < 15; i++) {
        let particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.width = Math.random() * 5 + 2 + 'px';
        particle.style.height = particle.style.width;
        particle.style.left = Math.random() * 100 + '%';
        particle.style.background = 'white';
        particle.style.borderRadius = '50%';
        particle.style.animationDelay = Math.random() * 20 + 's';
        particle.style.animationDuration = Math.random() * 10 + 15 + 's';
        document.body.appendChild(particle);
    }
</script>

<div class="trips-container">
    <!-- Page Header -->
    <div class="page-header">
        <h1 class="page-title">
            <i class="bi bi-airplane"></i> Explore Our Trips
        </h1>
        <p class="page-subtitle">Discover your next adventure from our curated collection</p>
        <div class="search-button">
            <a href="@Url.Action("Search", "Dashboard")" class="btn-search">
                <i class="bi bi-search"></i> Search & Filter Trips
            </a>
        </div>
        <div class="trip-count" style="margin-top:1rem; color: rgba(255,255,255,0.95); font-weight:600;">
            Showing <strong id="tripCount">@Model.Count()</strong> trips
        </div>
    </div>

    @if (Model == null || !Model.Any())
    {
        <!-- Empty State -->
        <div class="empty-state">
            <i class="bi bi-compass"></i>
            <h2>No Trips Available</h2>
            <p>Check back soon for exciting new destinations!</p>
        </div>
    }
    else
    {
        <!-- Trips Grid -->
        <div class="trips-grid">
            @foreach (var trip in Model)
            {
                 <div class="trip-card@(User?.IsInRole("Admin") ?? false ? " has-admin-actions" : "")"
                     data-destination="@trip.Destination.ToLower()"
                     data-country="@trip.Country.ToLower()"
                     data-category="@trip.PackageType"
                     data-price="@(trip.DiscountPrice.HasValue && trip.DiscountPrice < trip.Price ? trip.DiscountPrice.Value : trip.Price)"
                     data-start-date="@trip.StartDate.ToString("yyyy-MM-dd")"
                     data-is-discount="@(trip.DiscountPrice.HasValue && trip.DiscountPrice < trip.Price ? "true" : "false")"
                     data-trip-id="@trip.TripID"
                     data-description="@trip.Description"
                     data-end-date='@trip.EndDate.ToString("MMM dd, yyyy")'
                     data-start-date-display='@trip.StartDate.ToString("MMM dd, yyyy")'
                     data-duration="@((trip.EndDate - trip.StartDate).Days)"
                     data-rooms="@trip.AvailableRooms"
                     data-package="@trip.PackageType"
                     data-image-count="@trip.ImageCount"
                     onclick="openTripModal(event, this, @trip.TripID)">
                    
                    @if (User?.IsInRole("Admin") ?? false)
                    {
                        <!-- Visibility Badge for Admin -->
                        <button type="button" 
                                class="visibility-badge @(trip.IsVisible ? "visible" : "hidden") toggle-visibility-btn" 
                                data-trip-id="@trip.TripID" 
                                onclick="event.stopPropagation(); toggleVisibility(event, @trip.TripID, @trip.IsVisible.ToString().ToLower())"
                                title="@(trip.IsVisible ? "Trip is visible to users - Click to hide" : "Trip is hidden from users - Click to show")">
                            <i class="bi @(trip.IsVisible ? "bi-eye-fill" : "bi-eye-slash-fill")"></i>
                            <span>@(trip.IsVisible ? "Visible" : "Hidden")</span>
                        </button>
                    }

                    <!-- Package Type Badge -->
                    <div class="package-badge">
                        <i class="bi bi-star-fill"></i> @trip.PackageType
                    </div>

                    <!-- Trip Image -->
                    <div class="trip-image-container">
                        @if (trip.HasImage)
                        {
                            <img src="@Url.Action("GetImage", "Dashboard", new { tripId = trip.TripID })" 
                                 alt="@trip.Destination" 
                                 class="trip-image" />
                        }
                        else
                        {
                            <div class="no-image-placeholder">
                                <i class="bi bi-image"></i>
                            </div>
                        }
                    </div>

                    <!-- Trip Details -->
                    <div class="trip-details">
                        <h3 class="trip-destination">@trip.Destination</h3>
                        <div class="trip-country">
                            <i class="bi bi-geo-alt-fill"></i>
                            <span>@trip.Country</span>
                        </div>

                        <div class="trip-info">
                            <div class="info-item">
                                <i class="bi bi-calendar-check"></i>
                                <span>@trip.ClosestStartDate.ToString("MMM dd, yyyy") - @trip.ClosestEndDate.ToString("MMM dd, yyyy")</span>
                            </div>
                            @if (trip.DateVariations.Any())
                            {
                                <div class="info-item" style="color: #6366f1; font-weight: 600;">
                                    <i class="bi bi-calendar-range"></i>
                                    <span>+@trip.DateVariations.Count more date@(trip.DateVariations.Count == 1 ? "" : "s")</span>
                                </div>
                            }
                        </div>

                        <p class="trip-description">@trip.Description</p>

                        @{
                            var avgRating = trip.RatingCount > 0 ? trip.RatingSum / (decimal)trip.RatingCount : 0m;
                            var fullStars = (int)avgRating;
                        }
                        <div class="trip-rating" data-trip-id="@trip.TripID" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 0;">
                            <div class="trip-rating-stars" data-trip-id="@trip.TripID" style="display: flex; gap: 0.1rem;">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    if (i <= fullStars)
                                    {
                                        <span style="color: #fbbf24; font-size: 0.95rem; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">★</span>
                                    }
                                    else if (i == fullStars + 1 && (avgRating % 1m) >= 0.5m)
                                    {
                                        <span style="color: #fbbf24; font-size: 0.95rem; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">★</span>
                                    }
                                    else
                                    {
                                        <span style="color: #cbd5e1; font-size: 0.95rem;">★</span>
                                    }
                                }
                            </div>
                            <span class="trip-rating-avg" data-trip-id="@trip.TripID" style="color: #6366f1; font-weight: 700; font-size: 0.9rem;">@avgRating.ToString("F1")</span>
                            <span class="trip-rating-count" data-trip-id="@trip.TripID" style="color: #64748b; font-size: 0.85rem;">(@trip.RatingCount)</span>
                        </div>

                        <!-- Price Section -->
                        <div class="trip-price-section">
                            <div class="price-container">
                                @if (trip.DiscountPrice.HasValue && trip.DiscountPrice < trip.Price)
                                {
                                    <span class="original-price">$@trip.Price.ToString("N2")</span>
                                    <span class="trip-price">$@trip.DiscountPrice.Value.ToString("N2")</span>
                                }
                                else
                                {
                                    <span class="trip-price">$@trip.Price.ToString("N2")</span>
                                }
                            </div>

                            @if (trip.DiscountPrice.HasValue && trip.DiscountPrice < trip.Price)
                            {
                                var discount = (int)(((trip.Price - trip.DiscountPrice.Value) / trip.Price) * 100);
                                <div class="discount-badge">
                                    @discount% OFF
                                </div>
                            }
                        </div>

                        <!-- Action Buttons -->
                        <div class="trip-actions">
                        @if (User?.IsInRole("Admin") ?? false)
                        {
                            <a href="@Url.Action("EditTrip", "Admin", new { id = trip.TripID })" 
                               class="edit-btn" 
                               onclick="event.stopPropagation();"
                               title="Edit this trip">
                                <i class="bi bi-pencil"></i>
                                <span>Edit</span>
                            </a>
                            <button type="button" class="delete-btn" data-trip-id="@trip.TripID" 
                                    onclick="deleteTrip(event, @trip.TripID)" 
                                    title="Delete this trip">
                                <i class="bi bi-trash"></i>
                                <span>Delete</span>
                            </button>
                        }
                        else
                        {
                            <!-- Quantity is selected in the trip modal only -->
                            <button type="button" class="btn-add-cart" onclick="event.stopPropagation(); addToCart(@trip.TripID, '@trip.Destination');" title="Add to cart">
                                <i class="bi bi-cart-plus"></i>
                                <span>Add to Cart</span>
                            </button>
                            <button type="button" class="btn-book-now" onclick="event.stopPropagation(); bookNow(@trip.TripID);" title="Buy now">
                                <i class="bi bi-lightning-charge"></i>
                                <span>Buy Now</span>
                            </button>
                        }
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

<script>
    (function() {
        const destinationFilter = document.getElementById('destinationFilter');
        const countryFilter = document.getElementById('countryFilter');
        const categoryFilter = document.getElementById('categoryFilter');
        const minPrice = document.getElementById('minPrice');
        const maxPrice = document.getElementById('maxPrice');
        const travelDateFilter = document.getElementById('travelDateFilter');
        const discountOnly = document.getElementById('discountOnly');
        const sortBy = document.getElementById('sortBy');
        const applyBtn = document.getElementById('applyFilters');
        const resetBtn = document.getElementById('resetFilters');
        const tripCount = document.getElementById('tripCount');
        const tripsGrid = document.getElementById('tripsGrid');
        const tripCards = Array.from(document.querySelectorAll('.trip-card'));

        if (!applyBtn || !tripsGrid) return;

        function applyFiltersAndSort() {
            let filtered = tripCards;

            // Destination filter
            if (destinationFilter.value) {
                filtered = filtered.filter(card => 
                    card.dataset.destination.includes(destinationFilter.value.toLowerCase())
                );
            }

            // Country filter
            if (countryFilter.value) {
                filtered = filtered.filter(card => 
                    card.dataset.country.includes(countryFilter.value.toLowerCase())
                );
            }

            // Category filter
            if (categoryFilter.value) {
                filtered = filtered.filter(card => 
                    card.dataset.category === categoryFilter.value
                );
            }

            // Price range filter
            const min = minPrice.value ? parseFloat(minPrice.value) : 0;
            const max = maxPrice.value ? parseFloat(maxPrice.value) : Infinity;
            filtered = filtered.filter(card => {
                const price = parseFloat(card.dataset.price);
                return price >= min && price <= max;
            });

            // Travel date filter
            if (travelDateFilter.value) {
                const filterDate = new Date(travelDateFilter.value);
                filtered = filtered.filter(card => {
                    const startDate = new Date(card.dataset.startDate);
                    return startDate >= filterDate;
                });
            }

            // Discount only filter
            if (discountOnly.checked) {
                filtered = filtered.filter(card => card.dataset.isDiscount === 'true');
            }

            // Sort
            const sortValue = sortBy.value;
            if (sortValue === 'price-asc') {
                filtered.sort((a, b) => parseFloat(a.dataset.price) - parseFloat(b.dataset.price));
            } else if (sortValue === 'price-desc') {
                filtered.sort((a, b) => parseFloat(b.dataset.price) - parseFloat(a.dataset.price));
            } else if (sortValue === 'date') {
                filtered.sort((a, b) => new Date(a.dataset.startDate) - new Date(b.dataset.startDate));
            } else if (sortValue === 'popular') {
                // Most popular: shuffle for now (in a real app, this would come from a popularity metric)
                filtered.sort(() => Math.random() - 0.5);
            }

            // Update grid
            tripsGrid.innerHTML = '';
            filtered.forEach(card => {
                tripsGrid.appendChild(card.cloneNode(true));
            });

            // Update count
            tripCount.textContent = filtered.length;

            // Show empty message if no results
            if (filtered.length === 0) {
                tripsGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                        <p style="color: #64748b; font-size: 1.1rem;">No trips match your filters. Try adjusting your criteria.</p>
                    </div>
                `;
            }
        }

        function resetAllFilters() {
            destinationFilter.value = '';
            countryFilter.value = '';
            categoryFilter.value = '';
            minPrice.value = '';
            maxPrice.value = '';
            travelDateFilter.value = '';
            discountOnly.checked = false;
            sortBy.value = '';
            applyFiltersAndSort();
        }

        applyBtn.addEventListener('click', applyFiltersAndSort);
        resetBtn.addEventListener('click', resetAllFilters);

        // Optional: Apply filters on Enter key in text inputs
        [destinationFilter, countryFilter, minPrice, maxPrice].forEach(input => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') applyFiltersAndSort();
            });
        });
    })();

    // Trip Modal functionality
    let tripModal = null;
    let currentImages = [];
    let currentImageIndex = 0;

    function openTripModal(evt, button, tripId) {
        // If click originated from Buy/Add buttons, skip opening the trip modal
        if (evt && (evt.target.closest('.btn-book-now') || evt.target.closest('.btn-add-cart') || evt.target.closest('.delete-btn') || evt.target.closest('.edit-btn'))) {
            return;
        }

        const data = button.dataset;
        
        if (!tripModal) {
            createModal();
        }
        
        // Get card position for animation
        const card = button.closest('.trip-card');
        const cardRect = card.getBoundingClientRect();
        const modalContent = tripModal.querySelector('.modal-content');
        
        // Calculate position offset from center
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2;
        const cardCenterX = cardRect.left + cardRect.width / 2;
        const cardCenterY = cardRect.top + cardRect.height / 2;
        
        const offsetX = cardCenterX - centerX;
        const offsetY = cardCenterY - centerY;
        
        // Set CSS custom properties for animation
        modalContent.style.setProperty('--start-x', `${offsetX}px`);
        modalContent.style.setProperty('--start-y', `${offsetY}px`);
        
        // Populate modal with trip data
        document.getElementById('modal-title').textContent = data.destination;
        document.getElementById('modal-location').innerHTML = `<i class="bi bi-geo-alt-fill"></i> ${data.country}`;
        document.getElementById('modal-description').textContent = data.description;
        
        // Format dates properly
        const mainStartDate = new Date(data.startDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        const mainEndDate = new Date(data.endDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        document.getElementById('modal-dates').textContent = `${mainStartDate} - ${mainEndDate}`;
        document.getElementById('modal-duration').textContent = `${data.duration} days`;
        document.getElementById('modal-rooms').textContent = `${data.rooms} rooms`;
        document.getElementById('modal-package').textContent = data.package;
        document.getElementById('modal-price').textContent = `$${data.price}`;
        
        // Store trip ID for actions
        tripModal.dataset.tripId = tripId;
        tripModal.dataset.destination = data.destination;
        tripModal.dataset.mainStartDate = data.startDate;
        tripModal.dataset.mainEndDate = data.endDate;
        tripModal.dataset.mainRooms = data.rooms;
        tripModal.dataset.mainDuration = data.duration;
        // Configure modal quantity control
        try {
            const roomsCount = parseInt(data.rooms || '1', 10) || 1;
            const qtyControl = tripModal.querySelector('#modal-qty-control');
            const qtyDisplay = tripModal.querySelector('#modal-qty-display');
            const roomsHint = tripModal.querySelector('#modal-rooms-hint');
            if (qtyControl && qtyDisplay) {
                qtyControl.dataset.max = roomsCount;
                
                // If no rooms available, disable quantity controls
                if (roomsCount === 0) {
                    qtyDisplay.value = '0';
                    roomsHint.textContent = '0 available';
                    const btnInc = qtyControl.querySelector('.qty-increase');
                    const btnDec = qtyControl.querySelector('.qty-decrease');
                    if (btnInc) btnInc.disabled = true;
                    if (btnDec) btnDec.disabled = true;
                } else {
                    qtyDisplay.value = '1';
                    roomsHint.textContent = `${roomsCount} available`;
                    // initialize buttons disabled state
                    const btnInc = qtyControl.querySelector('.qty-increase');
                    const btnDec = qtyControl.querySelector('.qty-decrease');
                    if (btnInc) btnInc.disabled = false;
                    if (btnDec) btnDec.disabled = true;
                }
            }
        } catch (e) { console.error(e); }
        
        // Load images
        loadCarouselImages(tripId);
        
        // Load and display date variations
        loadDateVariations(tripId);
        
        // Show modal with animation
        tripModal.classList.add('active');
        modalContent.classList.add('expand-animation');
        document.body.style.overflow = 'hidden';
        
        // Remove animation class after it completes
        setTimeout(() => {
            modalContent.classList.remove('expand-animation');
        }, 500);
    }

    function createModal() {
        tripModal = document.createElement('div');
        tripModal.className = 'trip-modal';
        tripModal.innerHTML = `
            <div class="modal-content">
                <button class="modal-close" onclick="closeTripModal()">
                    <i class="bi bi-x"></i>
                </button>
                
                <div class="modal-trip-header">
                    <h2 class="modal-trip-title" id="modal-title"></h2>
                    <div class="modal-trip-location" id="modal-location"></div>
                    <p class="modal-trip-description" id="modal-description"></p>
                </div>
                
                <div class="photo-carousel">
                    <div class="carousel-main">
                        <div class="carousel-loading">Loading photos...</div>
                        <button class="carousel-arrow prev" onclick="prevImage()" style="display:none;">
                            <i class="bi bi-chevron-left"></i>
                        </button>
                        <button class="carousel-arrow next" onclick="nextImage()" style="display:none;">
                            <i class="bi bi-chevron-right"></i>
                        </button>
                        <div class="carousel-counter" style="display:none;"></div>
                    </div>
                    <div class="carousel-thumbnails"></div>
                </div>
                
                <div class="additional-details">
                    <div class="detail-item">
                        <strong><i class="bi bi-calendar-event"></i> Travel Dates</strong>
                        <span id="modal-dates"></span>
                    </div>
                    <div class="detail-item">
                        <strong><i class="bi bi-clock-history"></i> Duration</strong>
                        <span id="modal-duration"></span>
                    </div>
                    <div class="detail-item">
                        <strong><i class="bi bi-door-open"></i> Available Rooms</strong>
                        <span id="modal-rooms"></span>
                    </div>
                    <div class="detail-item">
                        <strong><i class="bi bi-tag"></i> Package Type</strong>
                        <span id="modal-package"></span>
                    </div>
                    <div class="detail-item">
                        <strong><i class="bi bi-currency-dollar"></i> Price</strong>
                        <span id="modal-price"></span>
                    </div>
                </div>
                
                <div class="modal-qty-row" style="display:flex;align-items:center;justify-content:center;padding:1rem 1.5rem;gap:1rem;">
                    <div class="qty-label" style="color:#475569;font-weight:600;">Quantity</div>
                    <div class="qty-control" id="modal-qty-control" data-max="1" style="display:flex;align-items:center;gap:0.5rem;background:linear-gradient(180deg,#fff,#f8fafc);padding:0.25rem;border-radius:0.75rem;box-shadow:0 6px 18px rgba(2,6,23,0.06);">
                        <button type="button" class="qty-btn qty-decrease" onclick="changeModalQty(-1)" style="background:transparent;border:none;font-size:1.4rem;padding:0.25rem 0.6rem;color:#475569;">−</button>
                        <input type="text" id="modal-qty-display" value="1" readonly style="width:48px;text-align:center;border:none;background:transparent;font-weight:700;color:#111827;font-size:1rem;">
                        <button type="button" class="qty-btn qty-increase" onclick="changeModalQty(1)" style="background:transparent;border:none;font-size:1.2rem;padding:0.25rem 0.6rem;color:#475569;">+</button>
                    </div>
                    <div id="modal-rooms-hint" style="color:#64748b;font-size:0.9rem;">&nbsp;</div>
                </div>

                <div id="modal-date-variations" class="date-variations-section" style="display:none;">
                    <h4 style="color:#1e293b;font-size:1.2rem;font-weight:700;margin-bottom:1rem;display:flex;align-items:center;gap:0.5rem;">
                        <i class="bi bi-calendar-range"></i> Available Date Options
                    </h4>
                    <div id="date-variations-list" class="date-variations-list"></div>
                </div>

                <div class="trip-actions">
                    <button class="btn-action btn-add-cart" onclick="addToCartFromModal()">
                        <i class="bi bi-cart-plus"></i>
                        Add to Cart
                    </button>
                    <button class="btn-action btn-book-now" onclick="bookNowFromModal()">
                        <i class="bi bi-lightning-charge"></i>
                        Book Now
                    </button>
                </div>

                <div id="modal-rating-section" style="background: linear-gradient(135deg, #f8fafc 0%, #eef2ff 100%); border: 1px solid #e2e8f0; border-radius: 1rem; padding: 1.25rem; margin-top: 1.5rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                        <i class="bi bi-star-fill" style="color: #fbbf24; font-size: 1.3rem;"></i>
                        <h4 style="color: #1e293b; font-weight: 700; margin: 0; font-size: 1.1rem;">Trip Ratings</h4>
                    </div>
                    <div id="modal-rating-display" style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                        <div style="font-size: 1.4rem; font-weight: 800; color: #6366f1;" id="rating-avg">0</div>
                        <div id="rating-stars" style="display: flex; gap: 0.15rem;"></div>
                        <div style="color: #64748b; font-size: 0.9rem; font-weight: 600;" id="rating-count">(0 ratings)</div>
                    </div>
                    <div id="rating-form-section" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #cbd5e1; display: none;">
                        <div style="color: #0f172a; font-weight: 700; font-size: 0.95rem; margin-bottom: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">Leave Your Rating</div>
                        <div class="star-picker" id="star-picker" style="display: flex; gap: 0.5rem; margin-bottom: 0.75rem;"></div>
                        <textarea id="rating-comment" placeholder="Share your experience (optional)" style="width: 100%; padding: 0.65rem; border: 1px solid #cbd5e1; border-radius: 0.6rem; font-family: inherit; font-size: 0.9rem; color: #1e293b; background: #ffffff; resize: vertical; min-height: 60px; transition: border-color 0.2s;"></textarea>
                        <button id="submit-rating-btn" style="background: linear-gradient(135deg, #6366f1 0%, #4338ca 100%); color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 0.6rem; font-weight: 700; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 12px rgba(99,102,241,0.3); width: 100%; margin-top: 0.75rem;" onclick="submitRating()">Submit Rating</button>
                    </div>
                    <div id="login-prompt" style="background: rgba(59,130,246,0.08); border: 1px solid rgba(59,130,246,0.3); border-radius: 0.75rem; padding: 0.85rem; color: #1e40af; font-size: 0.9rem; text-align: center; margin-top: 0.75rem; display: none;">
                        Please <a href="/Login" style="font-weight: 700; color: #1e40af; text-decoration: underline;">log in</a> to rate this trip.
                    </div>
                    <div id="reviews-list" style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #cbd5e1; display: none;">
                        <div style="color: #0f172a; font-weight: 700; font-size: 0.95rem; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.5px;">User Reviews</div>
                        <div id="reviews-container"></div>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(tripModal);
        
        // Close on background click
        tripModal.addEventListener('click', (e) => {
            if (e.target === tripModal) closeTripModal();
        });
    }

    function closeTripModal() {
        if (tripModal) {
            tripModal.classList.remove('active');
            document.body.style.overflow = '';
            currentImages = [];
            currentImageIndex = 0;
        }
    }

    async function loadCarouselImages(tripId) {
        const carouselMain = tripModal.querySelector('.carousel-main');
        const thumbnailsContainer = tripModal.querySelector('.carousel-thumbnails');
        const prevBtn = tripModal.querySelector('.carousel-arrow.prev');
        const nextBtn = tripModal.querySelector('.carousel-arrow.next');
        const counter = tripModal.querySelector('.carousel-counter');
        
        try {
            const response = await fetch(`/Dashboard/GetAllImages?tripId=${tripId}`);
            const data = await response.json();
            
            if (data.images && data.images.length > 0) {
                currentImages = data.images;
                currentImageIndex = 0;
                
                // Clear loading message
                carouselMain.innerHTML = '';
                
                // Create main images
                data.images.forEach((img, index) => {
                    const imgElement = document.createElement('img');
                    imgElement.src = img.imageUrl;
                    imgElement.alt = `Trip photo ${index + 1}`;
                    imgElement.className = 'carousel-image' + (index === 0 ? ' active' : '');
                    carouselMain.appendChild(imgElement);
                });
                
                // Create thumbnails
                thumbnailsContainer.innerHTML = '';
                data.images.forEach((img, index) => {
                    const thumb = document.createElement('img');
                    thumb.src = img.imageUrl;
                    thumb.alt = `Thumbnail ${index + 1}`;
                    thumb.className = 'thumbnail' + (index === 0 ? ' active' : '');
                    thumb.onclick = () => showImage(index);
                    thumbnailsContainer.appendChild(thumb);
                });
                
                // Show controls if more than one image
                if (data.images.length > 1) {
                    prevBtn.style.display = 'flex';
                    nextBtn.style.display = 'flex';
                    counter.style.display = 'block';
                    updateCounter();
                }
                
                // Add arrow controls to carousel main
                carouselMain.appendChild(prevBtn);
                carouselMain.appendChild(nextBtn);
                carouselMain.appendChild(counter);
            } else {
                carouselMain.innerHTML = '<div class="carousel-empty">No photos available</div>';
            }
        } catch (error) {
            console.error('Error loading images:', error);
            carouselMain.innerHTML = '<div class="carousel-empty">Failed to load photos</div>';
        }
    }

    function showImage(index) {
        const images = tripModal.querySelectorAll('.carousel-image');
        const thumbnails = tripModal.querySelectorAll('.thumbnail');
        
        images.forEach(img => img.classList.remove('active'));
        thumbnails.forEach(thumb => thumb.classList.remove('active'));
        
        images[index].classList.add('active');
        thumbnails[index].classList.add('active');
        
        currentImageIndex = index;
        updateCounter();
        
        // Scroll thumbnail into view
        thumbnails[index].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
    }

    function prevImage() {
        const newIndex = currentImageIndex === 0 ? currentImages.length - 1 : currentImageIndex - 1;
        showImage(newIndex);
    }

    function nextImage() {
        const newIndex = currentImageIndex === currentImages.length - 1 ? 0 : currentImageIndex + 1;
        showImage(newIndex);
    }

    function updateCounter() {
        const counter = tripModal.querySelector('.carousel-counter');
        if (counter && currentImages.length > 0) {
            counter.textContent = `${currentImageIndex + 1} / ${currentImages.length}`;
        }
    }

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (!tripModal || !tripModal.classList.contains('active')) return;
        
        if (e.key === 'Escape') {
            closeTripModal();
        } else if (e.key === 'ArrowLeft') {
            prevImage();
        } else if (e.key === 'ArrowRight') {
            nextImage();
        }
    });

    // Load and display date variations
    function loadDateVariations(tripId) {
        const section = document.getElementById('modal-date-variations');
        const list = document.getElementById('date-variations-list');
        
        if (!section || !list) return;
        
        // Find the trip in the model
        const trips = @Html.Raw(Json.Serialize(Model));
        const trip = trips.find(t => t.tripID === tripId);
        
        if (!trip) {
            section.style.display = 'none';
            return;
        }
        
        // Get main trip dates from modal dataset
        const mainStartDate = new Date(tripModal.dataset.mainStartDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        const mainEndDate = new Date(tripModal.dataset.mainEndDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        const mainRooms = parseInt(tripModal.dataset.mainRooms || '0');
        const mainDuration = parseInt(tripModal.dataset.mainDuration || '0');
        
        // Always show the section (main date + variations)
        section.style.display = 'block';
        
        // Create main date option (Option 1)
        let optionsHtml = `
            <div class="date-variation-item" onclick="selectDateVariation(-1, ${mainRooms}, '${mainStartDate}', '${mainEndDate}', ${mainDuration})" style="cursor: pointer; transition: all 0.2s;">
                <input type="radio" name="selected-date" value="-1" checked style="margin-right: 0.75rem;" />
                <div class="date-variation-info">
                    <div>
                        <i class="bi bi-calendar-check"></i>
                        <strong>Option 1 (Main):</strong>
                    </div>
                    <div>
                        <i class="bi bi-calendar-event"></i>
                        ${mainStartDate} - ${mainEndDate}
                    </div>
                    <div>
                        <i class="bi bi-clock"></i>
                        ${mainDuration} days
                    </div>
                    <div>
                        <i class="bi bi-door-open"></i>
                        ${mainRooms} rooms available
                    </div>
                </div>
            </div>
        `;
        
        // Add additional date variations (Option 2, 3, etc.) if they exist
        if (trip.dateVariations && trip.dateVariations.length > 0) {
            optionsHtml += trip.dateVariations.map((dateVar, index) => {
            const startDate = new Date(dateVar.startDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            const endDate = new Date(dateVar.endDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            const days = Math.ceil((new Date(dateVar.endDate) - new Date(dateVar.startDate)) / (1000 * 60 * 60 * 24));
            
            return `
                <div class="date-variation-item" onclick="selectDateVariation(${index}, ${dateVar.availableRooms}, '${startDate}', '${endDate}', ${days})" style="cursor: pointer; transition: all 0.2s;">
                    <input type="radio" name="selected-date" value="${index}" style="margin-right: 0.75rem;" />
                    <div class="date-variation-info">
                        <div>
                            <i class="bi bi-calendar-check"></i>
                            <strong>Option ${index + 2}:</strong>
                        </div>
                        <div>
                            <i class="bi bi-calendar-event"></i>
                            ${startDate} - ${endDate}
                        </div>
                        <div>
                            <i class="bi bi-clock"></i>
                            ${days} days
                        </div>
                        <div>
                            <i class="bi bi-door-open"></i>
                            ${dateVar.availableRooms} rooms available
                        </div>
                    </div>
                </div>
            `;
            }).join('');
        }
        
        list.innerHTML = optionsHtml;
        
        // Load and display ratings
        loadAndDisplayRatings(tripId);
    }

    // Load and display ratings
    async function loadAndDisplayRatings(tripId) {
        try {
            const response = await fetch(`/Dashboard/GetTripRatings?tripId=${tripId}`);
            const data = await response.json();
            
            // Update rating display
            const avgDisplay = document.getElementById('rating-avg');
            const starsContainer = document.getElementById('rating-stars');
            const countDisplay = document.getElementById('rating-count');
            
            if (avgDisplay && starsContainer && countDisplay) {
                const avg = data.trip.averageRating || 0;
                const count = data.trip.ratingCount || 0;
                
                avgDisplay.textContent = avg.toFixed(1);
                countDisplay.textContent = `(${count} ${count === 1 ? 'rating' : 'ratings'})`;
                
                // Display stars
                let starsHtml = '';
                for (let i = 1; i <= 5; i++) {
                    if (i <= Math.floor(avg)) {
                        starsHtml += '<span style="font-size: 1.1rem; color: #fbbf24; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">★</span>';
                    } else if (i === Math.floor(avg) + 1 && avg % 1 >= 0.5) {
                        starsHtml += '<span style="font-size: 1.1rem; color: #fbbf24; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">★</span>';
                    } else {
                        starsHtml += '<span style="font-size: 1.1rem; color: #cbd5e1;">★</span>';
                    }
                }
                starsContainer.innerHTML = starsHtml;
            }

            // Update trip card rating display
            const card = document.querySelector(`.trip-card[data-trip-id="${tripId}"]`);
            if (card) {
                const cardAvgEl = card.querySelector('.trip-rating-avg');
                const cardCountEl = card.querySelector('.trip-rating-count');
                const cardStarsEl = card.querySelector('.trip-rating-stars');
                const avg = data.trip.averageRating || 0;
                const count = data.trip.ratingCount || 0;

                if (cardAvgEl) cardAvgEl.textContent = avg.toFixed(1);
                if (cardCountEl) cardCountEl.textContent = `(${count})`;
                if (cardStarsEl) {
                    let starsHtml = '';
                    for (let i = 1; i <= 5; i++) {
                        if (i <= Math.floor(avg)) {
                            starsHtml += '<span style="color: #fbbf24; font-size: 0.95rem; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">★</span>';
                        } else if (i === Math.floor(avg) + 1 && avg % 1 >= 0.5) {
                            starsHtml += '<span style="color: #fbbf24; font-size: 0.95rem; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">★</span>';
                        } else {
                            starsHtml += '<span style="color: #cbd5e1; font-size: 0.95rem;">★</span>';
                        }
                    }
                    cardStarsEl.innerHTML = starsHtml;
                }
            }
            
            // Handle rating form visibility
            const formSection = document.getElementById('rating-form-section');
            const loginPrompt = document.getElementById('login-prompt');
            const starPicker = document.getElementById('star-picker');
            
            if (!data.isAuthenticated) {
                formSection.style.display = 'none';
                loginPrompt.style.display = 'block';
            } else if (data.hasBooked) {
                formSection.style.display = 'block';
                loginPrompt.style.display = 'none';
                
                // Populate star picker
                if (starPicker) {
                    let starsPickerHtml = '';
                    for (let i = 1; i <= 5; i++) {
                        const isSelected = data.userRating && data.userRating.rating === i;
                        starsPickerHtml += `<button type="button" class="star-btn ${isSelected ? 'active' : ''}" data-rating="${i}" onclick="selectRating(${i})" style="font-size: 2.2rem; background: none; border: none; cursor: pointer; color: ${isSelected ? '#fbbf24' : '#cbd5e1'}; transition: all 0.15s ease; padding: 0; line-height: 1;">★</button>`;
                    }
                    starPicker.innerHTML = starsPickerHtml;
                }
                
                // Pre-fill comment if user rated before
                const commentBox = document.getElementById('rating-comment');
                if (commentBox && data.userRating && data.userRating.comment) {
                    commentBox.value = data.userRating.comment;
                }
                
                // Set initial selected rating and update button text
                if (data.userRating) {
                    selectedRatingValue = data.userRating.rating;
                    const submitBtn = document.getElementById('submit-rating-btn');
                    if (submitBtn) {
                        submitBtn.textContent = 'Update Rating';
                    }
                } else {
                    selectedRatingValue = 0;
                    const submitBtn = document.getElementById('submit-rating-btn');
                    if (submitBtn) {
                        submitBtn.textContent = 'Submit Rating';
                    }
                }
            } else {
                formSection.style.display = 'none';
                loginPrompt.style.display = 'block';
                loginPrompt.textContent = 'You can only rate trips you have booked.';
            }
            
            // Store trip ID for rating submission
            window.currentRatingTripId = tripId;
            
            // Display reviews list
            const reviewsList = document.getElementById('reviews-list');
            const reviewsContainer = document.getElementById('reviews-container');
            
            if (reviewsList && reviewsContainer && data.ratings && data.ratings.length > 0) {
                reviewsList.style.display = 'block';
                let reviewsHtml = '';
                
                data.ratings.forEach(review => {
                    const stars = '★'.repeat(review.rating) + '☆'.repeat(5 - review.rating);
                    reviewsHtml += `
                        <div style="background: white; border: 1px solid #e2e8f0; border-radius: 0.75rem; padding: 1rem; margin-bottom: 0.75rem;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                <div>
                                    <div style="font-weight: 700; color: #1e293b; font-size: 0.95rem;">${review.userName}</div>
                                    <div style="color: #fbbf24; font-size: 1rem; letter-spacing: 0.05rem; margin-top: 0.25rem;">${stars}</div>
                                </div>
                                <div style="color: #64748b; font-size: 0.85rem;">${review.createdAt}</div>
                            </div>
                            ${review.comment ? `<div style="color: #475569; font-size: 0.9rem; line-height: 1.5; margin-top: 0.5rem;">${review.comment}</div>` : ''}
                        </div>
                    `;
                });
                
                reviewsContainer.innerHTML = reviewsHtml;
            } else if (reviewsList) {
                reviewsList.style.display = 'none';
            }
        } catch (error) {
            console.error('Error loading ratings:', error);
        }
    }

    let selectedRatingValue = 0;
    
    function selectRating(value) {
        selectedRatingValue = value;
        const buttons = document.querySelectorAll('.star-btn');
        buttons.forEach(btn => {
            const btnRating = parseInt(btn.getAttribute('data-rating'));
            if (btnRating <= value) {
                btn.classList.add('active');
                btn.style.color = '#fbbf24';
            } else {
                btn.classList.remove('active');
                btn.style.color = '#cbd5e1';
            }
        });
    }

    async function submitRating() {
        if (!selectedRatingValue) {
            showNotification('Please select a rating', 'error');
            return;
        }
        
        const comment = document.getElementById('rating-comment').value;
        const tripId = window.currentRatingTripId;
        const btn = document.getElementById('submit-rating-btn');
        
        if (!tripId) {
            showNotification('Error: Trip ID not found', 'error');
            return;
        }
        
        btn.disabled = true;
        btn.textContent = 'Submitting...';
        
        try {
            const response = await fetch('/Dashboard/SubmitRating', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ tripId, rating: selectedRatingValue, comment: comment || null })
            });
            
            const data = await response.json();
            
            if (data.success) {
                showNotification('Rating submitted successfully!', 'success');
                // Reload ratings to update display with new/updated rating
                await new Promise(resolve => setTimeout(resolve, 500));
                loadAndDisplayRatings(tripId);
            } else {
                showNotification(data.message || 'Failed to submit rating', 'error');
            }
        } catch (error) {
            console.error('Error submitting rating:', error);
            showNotification('Error submitting rating', 'error');
        } finally {
            btn.disabled = false;
            btn.textContent = 'Submit Rating';
        }
    }

    function selectDateVariation(index, rooms, startDate, endDate, days) {
        // Update the radio button by value, not by index position
        const radios = document.querySelectorAll('input[name="selected-date"]');
        radios.forEach((radio) => {
            radio.checked = (parseInt(radio.value) === index);
        });
        
        // Update modal display with selected date
        document.getElementById('modal-dates').textContent = `${startDate} - ${endDate}`;
        document.getElementById('modal-duration').textContent = `${days} days`;
        document.getElementById('modal-rooms').textContent = `${rooms} rooms`;
        
        // Update quantity control max
        const qtyControl = tripModal.querySelector('#modal-qty-control');
        const qtyDisplay = tripModal.querySelector('#modal-qty-display');
        if (qtyControl && qtyDisplay) {
            qtyControl.dataset.max = rooms;
            const currentQty = parseInt(qtyDisplay.value || '1', 10);
            if (currentQty > rooms) {
                qtyDisplay.value = rooms;
            }
        }
        
        // Store selected date index
        if (tripModal) {
            tripModal.dataset.selectedDateIndex = index;
        }
    }

    function addToCartFromModal() {
        const tripId = parseInt(tripModal.dataset.tripId);
        const destination = tripModal.dataset.destination;
        const qtyDisplay = tripModal.querySelector('#modal-qty-display');
        const quantity = qtyDisplay ? parseInt(qtyDisplay.value || '1', 10) : 1;
        const selectedDateIndex = parseInt(tripModal.dataset.selectedDateIndex || '-1', 10);
        
        // Directly call endpoint with quantity and selected date
        fetch('/User/AddToCart', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ tripId, quantity, selectedDateIndex })
        }).then(r => r.json()).then(data => {
            if (data.success) {
                if (data.onWaitlist) {
                    showNotification(data.message, 'info');
                } else {
                    showNotification(data.message, 'success');
                    
                    // Update available rooms count on the card and in modal
                    if (data.tripId && data.availableRooms !== undefined) {
                        const card = document.querySelector(`[data-trip-id="${data.tripId}"]`);
                        if (card) {
                            card.setAttribute('data-rooms', data.availableRooms);
                        }
                        
                        // Update modal if still open
                        if (tripModal && parseInt(tripModal.dataset.tripId) === data.tripId) {
                            const roomsDisplay = tripModal.querySelector('.rooms-available-text');
                            if (roomsDisplay) {
                                roomsDisplay.textContent = `${data.availableRooms} rooms available`;
                            }
                            
                            // Update quantity control max
                            const qtyControl = tripModal.querySelector('#modal-qty-control');
                            if (qtyControl) {
                                qtyControl.dataset.max = data.availableRooms;
                            }
                        }
                    }
                }
            } else {
                if (data.onWaitlist) {
                    showNotification(data.message, 'info');
                } else {
                    showNotification(data.message, 'error');
                }
            }
        }).catch(err => {
            console.error('Error adding to cart:', err);
            showNotification('Failed to add trip to cart. Please try again.', 'error');
        });
    }

    function bookNowFromModal() {
        const tripId = parseInt(tripModal.dataset.tripId);
        const qtyDisplay = tripModal.querySelector('#modal-qty-display');
        const quantity = qtyDisplay ? parseInt(qtyDisplay.value || '1', 10) : 1;
        // Close trip modal so checkout modal is fully visible
        closeTripModal();
        openPaymentModal(tripId, quantity);
    }

    function changeModalQty(delta) {
        if (!tripModal) return;
        const control = tripModal.querySelector('#modal-qty-control');
        const display = tripModal.querySelector('#modal-qty-display');
        if (!control || !display) return;
        const max = parseInt(control.dataset.max || '1', 10) || 1;
        let value = parseInt(display.value || '1', 10) || 1;
        value += delta;
        if (value < 1) value = 1;
        if (value > max) value = max;
        display.value = String(value);
        // Update button disabled state
        const btnInc = control.querySelector('.qty-increase');
        const btnDec = control.querySelector('.qty-decrease');
        if (btnInc) btnInc.disabled = value >= max;
        if (btnDec) btnDec.disabled = value <= 1;
    }

    // Shopping cart functionality
    async function addToCart(tripId, destination) {
        const card = document.querySelector(`[data-trip-id="${tripId}"]`);
        const qtyInput = card ? card.querySelector('.qty-input') : null;
        const quantity = qtyInput ? parseInt(qtyInput.value || '1', 10) : 1;
        const selectedDateIndex = -1; // Main date when adding from card
        
        try {
            const response = await fetch('/User/AddToCart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ tripId: tripId, quantity, selectedDateIndex })
            });

            const data = await response.json();
            
            if (data.success) {
                if (data.onWaitlist) {
                    // User was added to waitlist
                    showNotification(data.message, 'info');
                } else {
                    // Normal add to cart
                    showNotification(data.message, 'success');
                    
                    // Update available rooms count on the card
                    if (data.tripId && data.availableRooms !== undefined) {
                        const card = document.querySelector(`[data-trip-id="${data.tripId}"]`);
                        if (card) {
                            card.setAttribute('data-rooms', data.availableRooms);
                        }
                    }
                }
            } else {
                if (data.onWaitlist) {
                    showNotification(data.message, 'info');
                } else {
                    showNotification(data.message, 'error');
                }
            }
        } catch (error) {
            console.error('Error adding to cart:', error);
            showNotification('Failed to add trip to cart. Please try again.', 'error');
        }
    }

    function bookNow(tripId) {
        const card = document.querySelector(`[data-trip-id="${tripId}"]`);
        const qtyInput = card ? card.querySelector('.qty-input') : null;
        const quantity = qtyInput ? parseInt(qtyInput.value || '1', 10) : 1;
        openPaymentModal(tripId, quantity);
    }

    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: ${type === 'success' ? 'linear-gradient(135deg, #10b981, #059669)' : 'linear-gradient(135deg, #6366f1, #4f46e5)'};
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            animation: slideInRight 0.3s ease;
            font-weight: 600;
        `;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // Add animation keyframes
    const style = document.createElement('style');
    style.textContent = `
        @@keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        @@keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);

    // Toggle trip visibility function (admin only)
    async function toggleVisibility(event, tripId, currentVisibility) {
        event.preventDefault();
        event.stopPropagation();

        const button = event.currentTarget;
        if (button.classList.contains('loading')) return;

        // Show loading state
        button.classList.add('loading');
        const originalContent = button.innerHTML;

        try {
            const response = await fetch('@Url.Action("ToggleTripVisibility", "Admin")', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ tripId: tripId })
            });

            const result = await response.json();

            if (result.success) {
                // Update button appearance
                const isVisible = result.isVisible;
                button.classList.toggle('visible', isVisible);
                button.classList.toggle('hidden', !isVisible);
                button.title = isVisible 
                    ? 'Trip is visible to users - Click to hide' 
                    : 'Trip is hidden from users - Click to show';
                
                // Update button content
                button.innerHTML = `<i class="bi ${isVisible ? 'bi-eye-fill' : 'bi-eye-slash-fill'}"></i><span>${isVisible ? 'Visible' : 'Hidden'}</span>`;

                // Show success notification
                showNotification(result.message, 'success');
            } else {
                showNotification(result.message || 'Failed to update visibility', 'error');
                button.innerHTML = originalContent;
            }
        } catch (error) {
            console.error('Error:', error);
            showNotification('An error occurred while updating visibility', 'error');
            button.innerHTML = originalContent;
        } finally {
            button.classList.remove('loading');
        }
    }

    // Delete trip function (admin only)
    function deleteTrip(event, tripId) {
        event.preventDefault();
        event.stopPropagation();

        if (!confirm('Are you sure you want to delete this trip? This action cannot be undone.')) {
            return;
        }

        // Disable the button to prevent double-click
        const btn = event.target.closest('.delete-btn');
        if (btn) btn.disabled = true;

        // Send delete request to server
        const formData = new FormData();
        formData.append('tripId', tripId);
        
        fetch(`/Admin/DeleteTrip`, {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            return response.json();
        })
        .then(data => {
            if (data.success) {
                // Remove the trip card from the DOM with fade-out animation
                const tripCard = document.querySelector(`.trip-card[data-trip-id="${tripId}"]`) || 
                                event.target.closest('.trip-card');
                if (tripCard) {
                    tripCard.style.animation = 'fadeOut 0.4s ease forwards';
                    setTimeout(() => {
                        tripCard.remove();
                        // Update trip count
                        const tripCount = document.getElementById('tripCount');
                        if (tripCount) {
                            const current = parseInt(tripCount.textContent) || 0;
                            tripCount.textContent = Math.max(0, current - 1);
                        }
                        showNotification('Trip deleted successfully!', 'success');
                    }, 400);
                }
            } else {
                showNotification(data.message || 'Failed to delete trip', 'error');
                if (btn) btn.disabled = false;
            }
        })
        .catch(error => {
            console.error('Delete error:', error);
            showNotification('Error deleting trip: ' + error.message, 'error');
            if (btn) btn.disabled = false;
        });
    }

    // Add fade-out animation
    const fadeStyle = document.createElement('style');
    fadeStyle.textContent = `
        @@keyframes fadeOut {
            from {
                opacity: 1;
                transform: scale(1);
            }
            to {
                opacity: 0;
                transform: scale(0.95);
            }
        }
    `;
    document.head.appendChild(fadeStyle);
</script>

```